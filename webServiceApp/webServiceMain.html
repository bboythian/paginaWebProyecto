<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center">Reportes Ciberadiccion</h1>
        <h2 class="mt-4">Gráficos</h2>
        <div class="row">
            <div class="col-md-4">
                <h3>Gráfico de Pastel</h3>
                <canvas id="pieChart"></canvas>
            </div>
            <div class="col-md-6">
                <h3>Gráfico de Barras</h3>
                <canvas id="barChart"></canvas>
            </div>
            <div class="col-md-6 mt-4">
                <h3>Uso de Aplicaciones en el Último Mes</h3>
                <canvas id="monthlyLineChart"></canvas>
            </div>
            <div class="col-md-6 mt-4">
                <h3>Uso de Aplicaciones en la Última Semana</h3>
                <canvas id="weeklyLineChart"></canvas>
            </div>
            <div class="col-md-6 mt-4">
                <h3>Uso de Aplicaciones en el Último Día</h3>
                <canvas id="dailyLineChart"></canvas>
            </div>
        </div>
        <h2 class="mt-4">Reportes generales</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Cédula</th>
                    <th>Fecha</th>
                    <th>Mayor Consumo</th>
                    <th>Paquete 1</th>
                    <th>Tiempo Uso 1</th>
                    <th>Paquete 2</th>
                    <th>Tiempo Uso 2</th>
                    <th>Paquete 3</th>
                    <th>Tiempo Uso 3</th>
                    <th>Paquete 4</th>
                    <th>Tiempo Uso 4</th>
                    <th>Paquete 5</th>
                    <th>Tiempo Uso 5</th>
                </tr>
            </thead>
            <tbody id="data-table-body">
                <!-- Los datos se agregarán aquí dinámicamente -->
            </tbody>
        </table>
    </div>

    <script>
        const data = [{
                "cedula": "78979846546",
                "fecha": "2024-03-06",
                "mayorConsumo": "26",
                "packageName1": "Youtube",
                "tiempoUso1": "58",
                "packageName2": "Miapp",
                "tiempoUso2": "175",
                "packageName3": "Twitter",
                "tiempoUso3": "19",
                "packageName4": "NexusLauncher",
                "tiempoUso4": "17",
                "packageName5": "-",
                "tiempoUso5": "-"
            },
            {
                "cedula": "123456987",
                "fecha": "2024-03-06",
                "mayorConsumo": "26",
                "packageName1": "Miapp",
                "tiempoUso1": "12",
                "packageName2": "NexusLauncher",
                "tiempoUso2": "8",
                "packageName3": "com.android.settings",
                "tiempoUso3": "5",
                "packageName4": "-",
                "tiempoUso4": "-",
                "packageName5": "-",
                "tiempoUso5": "-"
            },
            {
                "cedula": "0105467260",
                "fecha": "2024-03-06",
                "mayorConsumo": "26",
                "packageName1": "Miapp",
                "tiempoUso1": "27",
                "packageName2": "NexusLauncher",
                "tiempoUso2": "12",
                "packageName3": "com.android.settings",
                "tiempoUso3": "5",
                "packageName4": "-",
                "tiempoUso4": "-",
                "packageName5": "-",
                "tiempoUso5": "-"
            },
            {
                "cedula": "0106770761",
                "fecha": "2024-03-26",
                "mayorConsumo": "26",
                "packageName1": "Instagram",
                "tiempoUso1": "26",
                "packageName2": "Miapp",
                "tiempoUso2": "17",
                "packageName3": "NexusLauncher",
                "tiempoUso3": "6",
                "packageName4": "-",
                "tiempoUso4": "-",
                "packageName5": "-",
                "tiempoUso5": "-"
            },
            {
                "cedula": "7894561235",
                "fecha": "2024-04-09",
                "mayorConsumo": "26",
                "packageName1": "NexusLauncher",
                "tiempoUso1": "11",
                "packageName2": "-",
                "tiempoUso2": "-",
                "packageName3": "-",
                "tiempoUso3": "-",
                "packageName4": "-",
                "tiempoUso4": "-",
                "packageName5": "-",
                "tiempoUso5": "-"
            }
        ];

        // Crear gráfico de pastel
        const pieChartCtx = document.getElementById('pieChart').getContext('2d');
        const pieChart = new Chart(pieChartCtx, {
            type: 'pie',
            data: {
                labels: ['Youtube', 'Miapp', 'Twitter', 'NexusLauncher'],
                datasets: [{
                    label: 'Tiempo de Uso',
                    data: [58, 175, 19, 17],
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                }]
            },
            options: {
                responsive: true
            }
        });

        // Crear gráfico de barras
        const barChartCtx = document.getElementById('barChart').getContext('2d');
        const barChart = new Chart(barChartCtx, {
            type: 'bar',
            data: {
                labels: data.map(item => item.packageName1),
                datasets: [{
                    label: 'Tiempo de Uso',
                    data: data.map(item => item.tiempoUso1),
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                }]
            },
            options: {
                responsive: true
            }
        });
         // Crear gráfico lineal del último mes
         const monthlyLineChartCtx = document.getElementById('monthlyLineChart').getContext('2d');
         const monthlyLineChart = new Chart(monthlyLineChartCtx, {
             type: 'line',
             data: {
                 labels: ['Semana 1', 'Semana 2', 'Semana 3', 'Semana 4'],
                 datasets: [{
                     label: 'Uso de Youtube',
                     data: [58, 64, 55, 62],
                     borderColor: '#FF6384',
                     fill: false
                 },
                 {
                     label: 'Uso de Miapp',
                     data: [175, 180, 190, 200],
                     borderColor: '#36A2EB',
                     fill: false
                 },
                 {
                     label: 'Uso de Twitter',
                     data: [19, 20, 21, 18],
                     borderColor: '#FFCE56',
                     fill: false
                 },
                 {
                     label: 'Uso de NexusLauncher',
                     data: [17, 16, 18, 17],
                     borderColor: '#4BC0C0',
                     fill: false
                 }]
             },
             options: {
                 responsive: true
             }
         });
 
         // Crear gráfico lineal de la última semana
         const weeklyLineChartCtx = document.getElementById('weeklyLineChart').getContext('2d');
         const weeklyLineChart = new Chart(weeklyLineChartCtx, {
             type: 'line',
             data: {
                 labels: ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'],
                 datasets: [{
                     label: 'Uso de Youtube',
                     data: [10, 15, 12, 20, 18, 25, 22],
                     borderColor: '#FF6384',
                     fill: false
                 },
                 {
                     label: 'Uso de Miapp',
                     data: [30, 28, 35, 32, 38, 40, 42],
                     borderColor: '#36A2EB',
                     fill: false
                 },
                 {
                     label: 'Uso de Twitter',
                     data: [5, 7, 6, 8, 9, 10, 11],
                     borderColor: '#FFCE56',
                     fill: false
                 },
                 {
                     label: 'Uso de NexusLauncher',
                     data: [4, 5, 6, 4, 5, 6, 7],
                     borderColor: '#4BC0C0',
                     fill: false
                 }]
             },
             options: {
                 responsive: true
             }
         });
 
         // Crear gráfico lineal del último día
         const dailyLineChartCtx = document.getElementById('dailyLineChart').getContext('2d');
         const dailyLineChart = new Chart(dailyLineChartCtx, {
             type: 'line',
             data: {
                 labels: ['0-1', '1-2', '2-3', '3-4', '4-5', '5-6', '6-7', '7-8', '8-9', '9-10', '10-11', '11-12', '12-13', '13-14', '14-15', '15-16', '16-17', '17-18', '18-19', '19-20', '20-21', '21-22', '22-23', '23-24'],
                 datasets: [{
                     label: 'Uso de Youtube',
                     data: [2, 3, 2, 4, 3, 5, 6, 7, 6, 8, 9, 7, 8, 9, 10, 11, 12, 10, 9, 8, 7, 6, 5, 4],
                     borderColor: '#FF6384',
                     fill: false
                 },
                 {
                     label: 'Uso de Miapp',
                     data: [5, 6, 5, 7, 6, 8, 9, 10, 11, 12, 13, 14, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4],
                     borderColor: '#36A2EB',
                     fill: false
                 },
                 {
                     label: 'Uso de Twitter',
                     data: [1, 2, 1, 3, 2, 4, 3, 5, 4, 6, 5, 7, 6, 5, 4, 3, 2, 1, 2, 3, 4, 5, 6, 7],
                     borderColor: '#FFCE56',
                     fill: false
                 },
                 {
                     label: 'Uso de NexusLauncher',
                     data: [1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8, 8, 8],
                     borderColor: '#4BC0C0',
                     fill: false
                 }]
             },
             options: {
                 responsive: true
             }
         });


         // Obtener la lista de usuarios al cargar la página
         fetch('/get-reportes')
         .then(response => response.json())
         .then(reportes => {
             const dataTableBody  = document.getElementById('data-table-body');
             const data = [];
             reportes.forEach(item  => {
                 const row = document.createElement('tr');
                 row.innerHTML = `
                     <td>${item.cedula}</td>
                     <td>${item.fecha}</td>
                     <td>${item.mayorConsumo}</td>

                     <td>${item.packageName1}</td>
                     <td>${item.tiempoUso1}</td>

                     <td>${item.packageName2}</td>
                     <td>${item.tiempoUso2}</td>

                     <td>${item.packageName3}</td>
                     <td>${item.tiempoUso3}</td>
                     
                     <td>${item.packageName4}</td>
                     <td>${item.tiempoUso4}</td>
                     
                     <td>${item.packageName5}</td>
                     <td>${item.tiempoUso5}</td>

                 `;
                 dataTableBody.appendChild(row);
                 // Agregar datos a la colección 'data'
                 data.push({
                     packageName1: item.packageName1,
                     tiempoUso1: item.tiempoUso1,
                     packageName2: item.packageName2,
                     tiempoUso2: item.tiempoUso2,
                     packageName3: item.packageName3,
                     tiempoUso3: item.tiempoUso3,
                     packageName4: item.packageName4,
                     tiempoUso4: item.tiempoUso4,
                     packageName5: item.packageName5,
                     tiempoUso5: item.tiempoUso5
                 });
             });
         })
         .catch(err => {
             console.error('Error al obtener usuarios:', err);
         });

    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>
